---
- name: Check connectivity and environment of all hosts
  hosts: all
  gather_facts: false
  become: false

  tasks:
    - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (ping module)
      ansible.builtin.ping:

    - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH (whoami)
      ansible.builtin.command: whoami
      register: whoami_result

    - name: –í—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ansible.builtin.debug:
        msg: "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ {{ inventory_hostname }} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–∞–∫ {{ whoami_result.stdout }}"

    - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ sudo-–¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –ø–∞—Ä–æ–ª—è
      become: true
      ansible.builtin.command: whoami
      register: sudo_check
      ignore_errors: true

    - name: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ sudo
      ansible.builtin.debug:
        msg: >-
          {% if sudo_check.rc == 0 %}
          ‚úÖ sudo –¥–æ—Å—Ç—É–ø –±–µ–∑ –ø–∞—Ä–æ–ª—è –µ—Å—Ç—å
          {% else %}
          ‚ö†Ô∏è sudo —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—å –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
          {% endif %}

    - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–±—Ä–∞—Ç—å —Ñ–∞–∫—Ç—ã
      ansible.builtin.setup:
      register: facts
      ignore_errors: true

    - name: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∞ —Ñ–∞–∫—Ç–æ–≤
      ansible.builtin.debug:
        msg: >-
          {% if facts.failed is defined and facts.failed %}
          ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–±—Ä–∞—Ç—å —Ñ–∞–∫—Ç—ã
          {% else %}
          ‚úÖ –§–∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω—ã ({{ facts.ansible_facts['ansible_distribution'] }} {{ facts.ansible_facts['ansible_distribution_version'] }})
          {% endif %}

    - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (ping 8.8.8.8)
      ansible.builtin.shell: ping -c 1 8.8.8.8
      register: ping_test
      ignore_errors: true

    - name: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
      ansible.builtin.debug:
        msg: >-
          {% if ping_test.rc == 0 %}
          ‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
          {% else %}
          ‚ö†Ô∏è –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
          {% endif %}

