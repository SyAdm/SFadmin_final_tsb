---
- name: Check connectivity and environment of all hosts
  hosts: "{{ target_hosts | default('all') }}"
  gather_facts: false
  become: false

  tasks:
    - name: ðŸ”¹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° SSH-Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ (ping module)
      ansible.builtin.ping:

    - name: ðŸ”¹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ SSH (whoami)
      ansible.builtin.command: whoami
      register: whoami_result
      changed_when: false
      ignore_errors: true

    - name: Ð’Ñ‹Ð²Ð¾Ð´ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
      ansible.builtin.debug:
        msg: "Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð° {{ inventory_hostname }}: {{ whoami_result.stdout | default('Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ (check mode Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°)') }}"
      when: whoami_result is defined

    - name: ðŸ”¹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ansible Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ñ„Ð°ÐºÑ‚Ñ‹
      ansible.builtin.setup:
      register: facts_result
      ignore_errors: true

    - name: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°ÐºÑ‚Ð¾Ð²
      ansible.builtin.debug:
        msg: >
          {{ inventory_hostname }}:
          OS={{ facts_result.ansible_facts['ansible_distribution'] | default('N/A') }}
          Version={{ facts_result.ansible_facts['ansible_distribution_version'] | default('N/A') }}
          IP={{ facts_result.ansible_facts['ansible_default_ipv4']['address'] | default('N/A') }}
      when: facts_result is defined

