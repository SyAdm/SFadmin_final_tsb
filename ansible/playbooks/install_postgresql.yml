# playbooks/install_postgresql.yml
---
- name: Install and configure PostgreSQL
  hosts: "{{ target_hosts | default('postgresql') }}"
  become: true
  gather_facts: true

  vars:
    postgresql_port: 5432
    postgresql_listen_addresses: "localhost"
    postgresql_postgres_password: "postgres123"  # –ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
    
    # Example databases and users
    postgresql_databases:
      - name: myapp
        encoding: UTF-8
        owner: postgres
      - name: testdb
        encoding: UTF-8

    postgresql_users:
      - name: myuser
        password: "mysecurepassword123"
        role_attr_flags: "LOGIN"

  roles:
    - postgresql

- name: üéØ POSTGRESQL INSTALLATION SUMMARY
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Show PostgreSQL deployment report
      debug:
        msg: |
          
          ============================================
          üêò POSTGRESQL DEPLOYMENT COMPLETE
          ============================================
          
          üìä DEPLOYMENT INFO:
          ‚Ä¢ Target: {{ target_hosts | default('postgresql') }}
          ‚Ä¢ Server: {{ groups[target_hosts | default('postgresql')][0] }}
          ‚Ä¢ Port: 5432
          
          üóÉÔ∏è  DATABASES CREATED:
          {% for db in postgresql_databases %}
          ‚Ä¢ {{ db.name }}{% endfor %}
          
          üë• USERS CREATED:
          {% for user in postgresql_users %}
          ‚Ä¢ {{ user.name }}{% endfor %}
          
          üîê AUTHENTICATION:
          ‚Ä¢ MD5 authentication enabled
          ‚Ä¢ Password authentication ready
          
          üîó CONNECTION EXAMPLES:
          ‚Ä¢ psql -h {{ groups[target_hosts | default('postgresql')][0] }} -U postgres -W
          ‚Ä¢ psql -h {{ groups[target_hosts | default('postgresql')][0] }} -U myuser -d myapp -W
          
          ‚ö° VERIFICATION:
          ansible {{ target_hosts | default('postgresql') }} -m shell -a "sudo -u postgres psql -c '\l'" -b
